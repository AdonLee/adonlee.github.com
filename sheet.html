<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="//bower.yizhi.com/bootstrap3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="//bower.yizhi.com/swiper/dist/css/swiper.min.css">
</head>
<body>
    <div class="navbar navbar-transparent">
        <div class="container-fluid">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#home">Home</a></li>
                    <li><a href="#sheet">Sheet</a></li>
                    <li><a href="#validation">Parse Validation</a></li>
                </ul>
            </div>

        </div>

    </div>
        <main class="content-flex main-content">
        <section id="reel-expand">
            <style>
                @keyframes reel-expand-left {
                    0% {
                        transform: translateX(50vw);
                    }

                    100% {
                        transform: translateX(0px);
                    }
                }
                @keyframes reel-expand-right {
                    0% {
                        transform: translateX(50vw);
                    }

                    100% {
                        transform: translateX(345px);
                    }
                }
                .reel-expand {
                    height: 150px;
                    width: 100%;
                    background-color: beige;
                }
                .reel-expand::before, .reel-expand::after {
                    content: '';
                    display: inline-block;
                    height: 100%;
                    width: 30px;
                    background-color: red;
                    position: relative;
                }
                .reel-expand::before {
                    /*margin-left: -30px;*/
                    /*transform: translateX(50%);*/
                    animation: reel-expand-left 3s ease-in-out;
                }
                .reel-expand::after {
                    transform: translateX(345px);
                    animation: reel-expand-right 3s ease-in-out;
                }

            </style>
            <div class="reel-expand" style="width: 100%"></div>
        </section>
        <section id="home">
            <style>
                .slide {
                    /*width: 100%;*/
                    height: 66vw;
                    line-height: 66vw;
                    text-align: center;
                    font-size: 30vw;
                }
                .slide1 {
                    background-image: linear-gradient(to right, rgb(17, 187, 17), yellow);
                }
                .slide2 {
                    background-image: linear-gradient(to right, #f7eded, #4a4949);
                }
                .slide3 {
                    background-image: linear-gradient(to right, #5858ef, #f1c6c6);
                }
            </style>
            <div class="view row">
                <div class="js-slider-wrapper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide slide slide1">1</div>
                        <div class="swiper-slide slide slide2">2</div>
                        <div class="swiper-slide slide slide3">3</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="validation">
            <div class="view">
                <textarea id="json_text" id="" cols="30" rows="10" style="width:100%"></textarea>
                <div id="validate_result"></div>
            </div>
            <script>
                function getType(obj) {
                    return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase();
                }
                function Validator(config) {
                    this.value = config.value
                    this.type = config.type
                    this.omitable = config.omitable
                    Object.defineProperty(this, '__validator', {
                        value: true,
                        enumberable: false
                    })
                }
                Validator.is = function(obj) {

                    return obj && !!obj.__validator
                }
                Validator.prototype.toHtml = function() {

                    return `<select name="" id="">
                            <option ${this.type == 'string' ? 'selected' : ''} value="string">String</option>
                            <option ${this.type == 'null'   ? 'selected' : ''} value="null">Null</option>
                            <option ${this.type == 'number' ? 'selected' : ''} value="number">Number</option>
                            <option ${this.type == 'boolean'? 'selected' : ''} value="boolean">Boolean</option>
                            <option ${this.type == 'object' ? 'selected' : ''} value="object">Object</option>
                        </select>
                        <span>${this.value}</span>`
                }

                function outputValidation(obj) {
                    var result = Object.keys(obj||[]).map(item => {
                        let value = obj[item];
                        if (Validator.is(value)) value = value.toHtml();
                        else value = `<span>${obj[item] ? obj[item] instanceof Array ? 'array' : 'object' : 'null'}</span>` + outputValidation(value);
                        return `<li class="js-valid-item has-child"><span class="key">${item}</span>${value}</li>`
                    }).join('\n')

                    return `<ul>${result}</ul>`

                }

                function parseValidation(obj) {
                    if ('object' !== getType(obj)) return {}
                    Object.keys(obj).map(item => {
                        let value = obj[item],
                            type = getType(value);
                        if (type === 'object') parseValidation(value)
                        else {
                            obj[item] = new Validator({value, type})
                        }
                    })
                    return obj
                }

                document.querySelector('#json_text').value = localStorage.getItem('parse_text', '{}')
                document.querySelector('#json_text').addEventListener('input', ({target}) =>{
                    let jsonText = target.value, json
                    if (!jsonText) {return true}
                    try {
                        json = eval('_____a='+jsonText)
                        delete window._____a
                    } catch (e) {
                        return true
                    }
                    let result = parseValidation(json)
                    localStorage.setItem('parse_text', jsonText)
                    console.log(result)
                    document.querySelector('#validate_result').innerHTML = outputValidation(result)
                    document.querySelector('.js-valid-item').addEventListener('click', e => {
                        e.target.classList.toggle('hide-child')
                    })
                })
                // document.querySelector('#json_text').change()
            </script>
        </section>

        <section>
            <li class="js-item has-child hide-child view" id="sheet">window</li>
            <script>
                var getKeys = obj=> {
                    var keys = []
                    for(var i in obj) keys.push(i)
                    return keys
                }

                document.querySelector('.js-item').addEventListener('click', ({target}) => {
                    if (!target.classList.contains('has-child')) return this
                    target.classList.toggle('hide-child')
                    if (target.children.length) return this
                    var parent = (target.parentElement._parent || window)[target.dataset.item] || window;

                    var tpl = getKeys(parent)
                    .sort((a,b)=>{
                        var _a = (typeof parent[a]) + a;
                        var _b = (typeof parent[b]) + b;
                        return  _a > _b ? 1 : -1
                    })
                    .map(item=>{
                        var child = parent[item]
                        var type = typeof child
                        var hasChild = child && typeof child !== 'string' && getKeys(child).length
                        // if (typeof child !== 'string') return '';
                        if (child === null && item.startsWith('on')) {
                            type = 'event'
                        }
                        return `<li class="js-item ${hasChild?'has-child':''} hide-child ${type}" data-item="${item}">${item}${type === 'function' ? '()' : ''}</li>`
                    }).join('');
                    if (!tpl) return this;
                    var list = document.createElement('ul');
                    list.innerHTML = tpl
                    list._parent = parent
                    target.appendChild(list);
                })
                // document.querySelector('.js-item').click()
            </script>
        </section>
        </main>

    </div>
</body>
<script src="//npm.yizhi.com/jquery/dist/jquery.min.js"></script>
<script src="//bower.yizhi.com/swiper/dist/js/swiper.jquery.min.js"></script>
<script>
    $(function() {
        var _swiper;
        function initSwiper() {
            if (location.hash == '#home')
                _swiper = _swiper || $('.js-slider-wrapper').swiper({
                    autoplay: true,
                    speed: 3000,
                    loop: true,
                    effect: 'slide'
                });
        }
        initSwiper()
        $(window).on('hashchange', initSwiper)

    })

</script>
</html>
